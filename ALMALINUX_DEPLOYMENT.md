# AlmaLinux Deployment Guide - Stock Management Backend

This guide explains how to set up and run the Node.js backend on an AlmaLinux server.

## 1. Prerequisites

Update your system and install Node.js and Git.

```bash
# Update system
sudo dnf update -y

# Install Git
sudo dnf install git -y

# Install Node.js (Version 18+ recommended)
curl -sL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo dnf install -y nodejs
```

## 2. Clone and Install

```bash
# Clone your repository
git clone https://github.com/amjooky/stocksManag.git
cd stocksManag

# Install dependencies
npm install
```

## 3. Configure Environment

Create a `.env` file in the root directory:

```bash
cp .env.example .env
nano .env
```

Ensure the following variables are set:
```env
NODE_ENV=production
PORT=5000
JWT_SECRET=your_secure_random_secret_here
# If your frontend is on Vercel, use its URL, or * for all
FRONTEND_URL=*
```

## 4. Firewall Setup

Allow traffic on your backend port (default 5000):

```bash
sudo firewall-cmd --permanent --add-port=5000/tcp
sudo firewall-cmd --reload
```

## 5. Reverse Proxy with Nginx (Recommended)

To run on port 80/443 and handle SSL:

```bash
sudo dnf install nginx -y
sudo systemctl enable --now nginx
```

Create a configuration: `/etc/nginx/conf.d/stocks.conf`
```nginx
server {
    listen 80;
    server_name your_domain_or_ip;

    location / {
        proxy_pass http://localhost:5000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## 6. Process Management (PM2)

Use PM2 to keep the app running in the background and restart on crash/reboot.

```bash
# Install PM2 globally
sudo npm install -p pm2 -g

# Start the application
pm2 start app.js --name "stock-backend"

# Set up startup script
pm2 save
pm2 startup
# (Run the command generated by pm2 startup)
```

## 7. Database Persistence

Since this project uses **SQLite**, the database file `backend/database/stock_management.db` will be created automatically. Ensure the user running the app has write permissions to that directory.

```bash
mkdir -p backend/database
chmod 755 backend/database
```

## 8. Logs

View your backend logs anytime with:
```bash
pm2 logs stock-backend
```
